<?xml version="1.0" ?>
<!--@POSTPROC: ./postproc.sh-->
<module>

<User f="nodata">
  <User f="noscroll">
    <User    t="dropdown" f="user"/>
    <Log_in t="button" l="Start"/>
  </User>
</User>

<Start f="nodata">
  <Main>
    <Create_new_Record t="button" l="Feature"/>
    <autonum/>
    <GPS_Diagnostics t="gpsdiag"/>
  </Main>
  <search>
    Records
  </search>
  <Table f="noscroll">
    <Select_Date t="dropdown"/>
    <Table t="table"/>
  </Table>
  <Map f="noscroll">
    <Map t="map"/>
    <Create_Shape t="button" l="Shape"/>
  </Map>
</Start>

<Feature>
  <fmt>{{Feature_ID}}</fmt>
  <General>
    <Validate t="button"/>
    <Feature_ID f="notnull autonum"/>
    <Date f="readonly"/>
    <author/>
    <Type f="notnull">
      <opts>
        <opt>Chamber Tomb</opt>
        <opt>Cistern stairs</opt>
        <opt>Road</opt>
        <opt>Shaft opening</opt>
        <opt>Wall</opt>
        <opt>Misc structure</opt>
        <opt>Artefact scatter</opt>
        <opt>Isolate architectural member</opt>
        <opt>Isolated artefact</opt>
        <opt>Other feature</opt>
      </opts>
    </Type>
    <Source>
      <opts>
        <opt>Legacy verification</opt>
        <opt>Remote sensing ground truthing</opt>
        <opt>Survey</opt>
        <opt>Local informant</opt>
        <opt>Serendipity</opt>
        <opt>Other</opt>
      </opts>
    </Source>
    <Description_of_Feature_or_Locale>
      <desc>
        Describe the location in relation to local topography and relief (optional)
      </desc>
    </Description_of_Feature_or_Locale>
    <Landuse_around_Feature t="picture" f="notnull htmldesc">
      <desc><![CDATA[
        <i>Description:</i>
        <br>
        <div>
            <p>Landuse around the feature. Choose the majority landuse.</p>
            <hr/>
        </div>
      ]]></desc>
      <opts>
        <opt p="gallery/Around_Landuse/Agr_Seedling_9063_Overview_NW01.JPG">
          Annual agriculture
          <desc><![CDATA[
            <div>
              <div>
                <p>Annual agriculture</p>
              </div>
              <div>
                <img style="width:100%" src="files/data/gallery/Around_Landuse/Agr_Seedling_9063_Overview_NW01.JPG" alt="files/data/gallery/Around_Landuse/Agr_Seedling_9063_Overview_NW01.JPG"/>
              </div>
              <div>
                <img style="width:100%" src="files/data/gallery/Around_Landuse/Agr_Seedling_9078_Overview_NW01.JPG" alt="files/data/gallery/Around_Landuse/Agr_Seedling_9078_Overview_NW01.JPG"/>
              </div>
              <div>
                <img style="width:100%" src="files/data/gallery/Around_Landuse/Agr_Harrowed_9058_Overview_SE01.JPG" alt="files/data/gallery/Around_Landuse/Agr_Harrowed_9058_Overview_SE01.JPG"/>
              </div>
              <div>
                <img style="width:100%" src="files/data/gallery/Around_Landuse/Agr_Harrowed_9080_Overview_SE01.JPG" alt="files/data/gallery/Around_Landuse/Agr_Harrowed_9080_Overview_SE01.JPG"/>
              </div>
              <div>
                <img style="width:100%" src="files/data/gallery/Around_Landuse/Agr_Ploughed_9158_Overview_S.JPG" alt="files/data/gallery/Around_Landuse/Agr_Ploughed_9158_Overview_S.JPG"/>
              </div>
              <hr/>
            </div>
          ]]></desc>
        </opt>
        <opt p="gallery/Around_Landuse/Perennial_Roses.JPG">
          Perennial agriculture (e.g orchard or vineyard)
          <desc><![CDATA[
            <div>
              <div>
                <p>Perennial agriculture (e.g orchard or vineyard)</p>
              </div>
              <div>
                <img style="width:100%" src="files/data/gallery/Around_Landuse/Perennial_Roses.JPG" alt="files/data/gallery/Around_Landuse/Perennial_Roses.JPG"/>
              </div>
              <div>
                <img style="width:100%" src="files/data/gallery/Around_Landuse/Perennial_Lavender.JPG" alt="files/data/gallery/Around_Landuse/Perennial_Lavender.JPG"/>
              </div>
              <hr/>
            </div>
          ]]></desc>
        </opt>
        <opt p="gallery/Around_Landuse/Pasture_9138_Overview_S01.JPG">
          Pasture (grassland)
          <desc><![CDATA[
            <div>
              <div>
                <p>Pasture (grassland)</p>
              </div>
              <div>
                <img style="width:100%" src="files/data/gallery/Around_Landuse/Pasture_9138_Overview_S01.JPG" alt="files/data/gallery/Around_Landuse/Pasture_9138_Overview_S01.JPG"/>
              </div>
              <div>
                <img style="width:100%" src="files/data/gallery/Around_Landuse/Pasture_9138_Detail_E_W_Direction.JPG" alt="files/data/gallery/Around_Landuse/Pasture_9138_Detail_E_W_Direction.JPG"/>
              </div>
              <div>
                <img style="width:100%" src="files/data/gallery/Around_Landuse/Pasture_9104_Overview_S.JPG" alt="files/data/gallery/Around_Landuse/Pasture_9104_Overview_S.JPG"/>
              </div>
              <div>
                <img style="width:100%" src="files/data/gallery/Around_Landuse/Pasture_9094_Overview_S.JPG" alt="files/data/gallery/Around_Landuse/Pasture_9094_Overview_S.JPG"/>
              </div>
              <div>
                <img style="width:100%" src="files/data/gallery/Around_Landuse/Pasture_9066_Overview_W01.JPG" alt="files/data/gallery/Around_Landuse/Pasture_9066_Overview_W01.JPG"/>
              </div>
              <hr/>
            </div>
          ]]></desc>
        </opt>
        <opt p="gallery/Around_Landuse/Scrub_9155_Overview_E01.JPG">
          Scrub
          <desc><![CDATA[
            <div>
              <div>
                <p>Scrub</p>
              </div>
              <div>
                <img style="width:100%" src="files/data/gallery/Around_Landuse/Scrub_9155_Overview_E01.JPG" alt="files/data/gallery/Around_Landuse/Scrub_9155_Overview_E01.JPG"/>
              </div>
              <hr/>
            </div>
          ]]></desc>
        </opt>
        <opt p="gallery/Around_Landuse/Forest_3097_Overview_W_2.JPG">
          Forest
          <desc><![CDATA[
            <div>
              <div>
                <p>Forest</p>
              </div>
              <div>
                <img style="width:100%" src="files/data/gallery/Around_Landuse/Forest_3097_Overview_W_2.JPG" alt="files/data/gallery/Around_Landuse/Forest_3097_Overview_W_2.JPG"/>
              </div>
              <div>
                <img style="width:100%" src="files/data/gallery/Around_Landuse/Forest_3111_Overview_N_2.JPG" alt="files/data/gallery/Around_Landuse/Forest_3111_Overview_N_2.JPG"/>
              </div>
              <hr/>
            </div>
          ]]></desc>
        </opt>
        <opt p="gallery/Around_Landuse/Urban.JPG">
          Urban (in a settlement or surrounded by infrastructure)
          <desc><![CDATA[
            <div>
              <div>
                <p>Urban (in a settlement or surrounded by infrastructure)</p>
              </div>
              <div>
                <img style="width:100%" src="files/data/gallery/Around_Landuse/Urban.JPG" alt="files/data/gallery/Around_Landuse/Urban.JPG"/>
              </div>
              <hr/>
            </div>
          ]]></desc>
        </opt>
        <opt p="gallery/Around_Landuse/Other_3276_Overview01_N.JPG">
          Other (explain in notes)
          <desc><![CDATA[
            <div>
              <div>
                <p>Other (explain in notes)</p>
              </div>
              <div>
                <img style="width:100%" src="files/data/gallery/Around_Landuse/Other_3276_Overview01_N.JPG" alt="files/data/gallery/Top_Landuse/Other_3276_Overview01_N.JPG"/>
              </div>
              <div>
                <img style="width:100%" src="files/data/gallery/Around_Landuse/Other_Scrub_2102_Overview_S01.JPG" alt="files/data/gallery/Top_Landuse/Other_Scrub_2102_Overview_S01.JPG"/>
              </div>
              <hr/>
            </div>
          ]]></desc>
        </opt>
      </opts>
    </Landuse_around_Feature>
    <Landuse_on_top_of_Feature t="picture" f="notnull htmldesc">
      <desc><![CDATA[
        <i>Description:</i>
        <br>
        <div>
            <p>Landuse on top of feature. Choose majority.</p>
            <hr/>
        </div>
      ]]></desc>
      <opts>
        <opt p="gallery/Top_Landuse/Agr_6015_Overview_N.jpg">
          Annual agriculture
          <desc><![CDATA[
            <div>
              <div>
                <p>Annual agriculture</p>
              </div>
              <div>
                <img style="width:100%" src="files/data/gallery/Top_Landuse/Agr_6015_Overview_N.jpg" alt="files/data/gallery/Top_Landuse/Agr_6015_Overview_N.jpg"/>
              </div>
              <div>
                <img style="width:100%" src="files/data/gallery/Top_Landuse/Agr_7012_Overview_1.JPG" alt="files/data/gallery/Top_Landuse/Agr_7012_Overview_1.JPG"/>
              </div>
              <hr/>
            </div>
          ]]></desc>
        </opt>
        <opt p="gallery/Top_Landuse/Perennial_9072_Overview_S01.JPG">
          Perennial agriculture (e.g orchard or vineyard)
          <desc><![CDATA[
            <div>
              <div>
                <p>Perennial agriculture (e.g orchard or vineyard)</p>
              </div>
              <div>
                <img style="width:100%" src="files/data/gallery/Top_Landuse/Perennial_9072_Overview_S01.JPG" alt="files/data/gallery/Top_Landuse/Perennial_9072_Overview_S01.JPG"/>
              </div>
              <hr/>
            </div>
          ]]></desc>
        </opt>
        <opt p="gallery/Top_Landuse/Grassland_3315_Overview_S.JPG">
          Pasture (grassland)
          <desc><![CDATA[
            <div>
              <div>
                <p>Pasture (grassland)</p>
              </div>
              <div>
                <img style="width:100%" src="files/data/gallery/Top_Landuse/Grassland_3315_Overview_S.JPG" alt="files/data/gallery/Top_Landuse/Grassland_3315_Overview_S.JPG"/>
              </div>
              <div>
                <img style="width:100%" src="files/data/gallery/Top_Landuse/Grassland_3299_Overview_NE.jpg" alt="files/data/gallery/Top_Landuse/Grassland_3299_Overview_NE.jpg"/>
              </div>
              <div>
                <img style="width:100%" src="files/data/gallery/Top_Landuse/Grassland_3208_Overview_W.JPG" alt="files/data/gallery/Top_Landuse/Grassland_3208_Overview_W.JPG"/>
              </div>
              <div>
                <img style="width:100%" src="files/data/gallery/Top_Landuse/Grassland_2081_Overview.jpg" alt="files/data/gallery/Top_Landuse/Grassland_2081_Overview.jpg"/>
              </div>
              <hr/>
            </div>
          ]]></desc>
        </opt>
        <opt p="gallery/Top_Landuse/Scrub_2099_Overview_W02.JPG">
          Scrub
          <desc><![CDATA[
            <div>
              <div>
                <p>Scrub</p>
              </div>
              <div>
                <img style="width:100%" src="files/data/gallery/Top_Landuse/Scrub_2099_Overview_W02.JPG" alt="files/data/gallery/Top_Landuse/Scrub_2099_Overview_W02.JPG"/>
              </div>
              <div>
                <img style="width:100%" src="files/data/gallery/Top_Landuse/Scrub_2013_Overview_E.JPG" alt="files/data/gallery/Top_Landuse/Scrub_2013_Overview_E.JPG"/>
              </div>
              <div>
                <img style="width:100%" src="files/data/gallery/Top_Landuse/Scrub_3253_Overview_S.jpg" alt="files/data/gallery/Top_Landuse/Scrub_3253_Overview_S.jpg"/>
              </div>
              <div>
                <img style="width:100%" src="files/data/gallery/Top_Landuse/Scrub_6019_Overview_E.jpg" alt="files/data/gallery/Top_Landuse/Scrub_6019_Overview_E.jpg"/>
              </div>
              <hr/>
            </div>
          ]]></desc>
        </opt>
        <opt p="gallery/Top_Landuse/Forest_3267_Overview_W02.jpg">
          Forest
          <desc><![CDATA[
            <div>
              <div>
                <p>Forest</p>
              </div>
              <div>
                <img style="width:100%" src="files/data/gallery/Top_Landuse/Forest_3267_Overview_W02.jpg" alt="files/data/gallery/Top_Landuse/Forest_3267_Overview_W02.jpg"/>
              </div>
              <div>
                <img style="width:100%" src="files/data/gallery/Top_Landuse/Forest_3410_Overview_W.JPG" alt="files/data/gallery/Top_Landuse/Forest_3410_Overview_W.JPG"/>
              </div>
              <div>
                <img style="width:100%" src="files/data/gallery/Top_Landuse/Forest_3111_Overview_N_2.JPG" alt="files/data/gallery/Top_Landuse/Forest_3111_Overview_N_2.JPG"/>
              </div>
              <div>
                <img style="width:100%" src="files/data/gallery/Top_Landuse/Forest_3097_Overview_W_2.JPG" alt="files/data/gallery/Top_Landuse/Forest_3097_Overview_W_2.JPG"/>
              </div>
              <div>
                <img style="width:100%" src="files/data/gallery/Top_Landuse/Forest_3051_Overview_S.jpg" alt="files/data/gallery/Top_Landuse/Forest_3051_Overview_S.jpg"/>
              </div>
              <hr/>
            </div>
          ]]></desc>
        </opt>
        <opt p="gallery/Top_Landuse/Urban.JPG">
          Urban (in a settlement or surrounded by infrastructure)
          <desc><![CDATA[
            <div>
              <div>
                <p>Urban (in a settlement or surrounded by infrastructure)</p>
              </div>
              <div>
                <img style="width:100%" src="files/data/gallery/Top_Landuse/Urban.JPG" alt="files/data/gallery/Top_Landuse/Urban.JPG"/>
              </div>
              <hr/>
            </div>
          ]]></desc>
        </opt>
        <opt p="gallery/Top_Landuse/Other_3276_Overview01_N.JPG">
          Other (explain in notes)
          <desc><![CDATA[
            <div>
              <div>
                <p>Other (explain in notes)</p>
              </div>
              <div>
                <img style="width:100%" src="files/data/gallery/Top_Landuse/Other_3276_Overview01_N.JPG" alt="files/data/gallery/Top_Landuse/Other_3276_Overview01_N.JPG"/>
              </div>
              <div>
                <img style="width:100%" src="files/data/gallery/Top_Landuse/Other_Scrub_2102_Overview_S01.JPG" alt="files/data/gallery/Top_Landuse/Other_Scrub_2102_Overview_S01.JPG"/>
              </div>
              <hr/>
            </div>
          ]]></desc>
        </opt>
      </opts>
    </Landuse_on_top_of_Feature>
    <Position_in_the_landscape>
      <opts>
        <opt>Valley Bottom or Plain</opt>
        <opt>
          Upper slope
          <desc>Upper and lower slope - mentally divide the slope in half and pinpoint your position within upper or lower part.</desc>
        </opt>
        <opt>Lower slope</opt>
        <opt>Hilltop</opt>
      </opts>
    </Position_in_the_landscape>
    <Feature_prominence f="notnull">
      <desc>
        This is the team's subjective measure of how prominent the feature is
        within its landscape setting. It is understood that other circumstances
        contribute to the overall measure, such as weather/visibility, line of
        approach, feature height, elevation, surrounding landuse, geomorphology,
        and vegetation. Teams are to assess how noticeable the feature is in its
        current condition and how controlling the view from the feature is. 
      </desc>
      <opts>
        <opt>
          Nil
          <desc>
            Not noticeable without preexisting information or without being
            within 50 m of it
          </desc>
        </opt>
        <opt>
          Low
          <desc>Not prominent, but noticeable at 50-250m distance</desc>
        </opt>
        <opt>
          Medium
          <desc>
            Noticeable once in line of sight, or noticeable at 250-500m
          </desc>
        </opt>
        <opt>
          High
          <desc>
            Noticeable at a considerable distance, or visible at &gt;500m
          </desc>
        </opt>
        <opt>
          Super prominent
          <desc>
            Noticeable at great distance, dominant point in local landscape
          </desc>
        </opt>
      </opts>
    </Feature_prominence>
    <gps f="notnull"/>
    <Handheld_GPS_point b="decimal"/>
    <Elevation b="decimal">
      Elevation (MASL)
      <desc>
        Only enter value if present in the map. List source in Annotation
      </desc>
    </Elevation>
    <Facing_Direction_For_Photo f="notnull">
      <opts>
        <opt>No Observation</opt>
        <opt>North</opt>
        <opt>Northeast</opt>
        <opt>East</opt>
        <opt>Southeast</opt>
        <opt>South</opt>
        <opt>Southwest</opt>
        <opt>West</opt>
        <opt>Northwest</opt>
        <opt>Other</opt>
      </opts>
    </Facing_Direction_For_Photo>
    <Notes_and_Photo_ID/>
    <Photo t="camera" f="notnull htmldesc">
      <desc><![CDATA[
        <i>Description:</i>
        <br>
        <div>
            <div>
            <p>Take one generval overview shot that includes the complete feature profile and a scale. The facing direction above should articulate which direction you were facing when taking the general overview shot.</p>
            </div>
            <div>
              <p>Example:</p>
            </div>
            <div>
              <img style="width:100%" src="files/data/gallery/Example_photo/2082.jpg" alt="files/data/gallery/Example_photo/2082.jpg"/>
            </div>
        </div>
      ]]></desc>
    </Photo>
  </General>

  <Additional_GPS>
    <New_GPS_Location lc="GPS_Location" t="button"/>
    <GPS_Location_List ec="GPS_Location" t="dropdown"/>
  </Additional_GPS>

  <Dimensions>
    <cols>
      <col>
        <Height_Max b="decimal" f="notnull">
          Height Max (m)
        </Height_Max>
        <Width_Max   b="decimal" f="notnull">
          Width Max (m)
        </Width_Max>
        <Length_Max   b="decimal" f="notnull">
          Length Max (m)
        </Length_Max>
        <Diameter_Max   b="decimal" f="notnull">
          Diameter Max (m)
          <desc>
            The longest axis in the diameter
          </desc>
        </Diameter_Max>
      </col>
      <col>
        <Height_Min b="decimal">
          Height Min (m)
        </Height_Min>
        <Width_Min   b="decimal">
          Width Min (m)
        </Width_Min>
        <Length_Min   b="decimal">
          Length Min (m)
        </Length_Min>
        <Diameter_Min   b="decimal">
          Diameter Min (m)
          <desc>
            The shorter axis in diameter, if feature ellipsoid
          </desc>
        </Diameter_Min>
      </col>
    </cols>
    <Additional_Dimension   b="decimal">
      Additional Dimension (m)
    </Additional_Dimension>
    <Other_Dimension/>
    <Shape_Notes/>
  </Dimensions>
  <Material>
    <Associated_Feature_or_Material t="checkbox">
      <desc>
        Stone wall (krepis) is found either at the foot of the feature, or inside it (upon excavation). Enclosure is a fence or a circle of variable material either around or some distance outside of the feature. Standing features in the vicinity comprise other standing stone or architectural features associated with the feature. Artefact scatter indicates a discrete and bounded concentration of manmade objects on the surface of the feature or its close vicinity. Loose artefacts indicates one or two artefacts dispersed on or around feature. Bones denote bioarchaeological remains, human or animal. Other - please use the annotation to describe.
      </desc>
      <opts>
        <opt>
          Bricks
        </opt>
        <opt>
          Glass
        </opt>
        <opt>
          Lithics
        </opt>
        <opt>
          Metal
        </opt>
        <opt>
          Pottery
        </opt>
        <opt>
          Tile
        </opt>
        <opt>
          Inscription
        </opt>
        <opt>
          Artefact scatter
        </opt>
        <opt>
          Bones
        </opt>
        <opt>
          Other architectuaral element
        </opt>
        <opt>
          Other feature
        </opt>
        <opt>
          Other
        </opt>
      </opts>
    </Associated_Feature_or_Material>
    <Surface_Material_Description>
      <desc>
        Please comment on the density, dimensions, boundedness, and other characteristics of the associated surface materials.
      </desc>
    </Surface_Material_Description>
    <Sample_Collected t="radio" f="notnull">
      Sample Collected?
      <opts>
        <opt>Yes</opt>
        <opt>No</opt>
      </opts>
    </Sample_Collected>
    <Chronology_Estimate/>
    <Associated_Feature_or_Material_Photo t="camera"/>
  </Material>
  <CRM>
    <Condition f="notnull">
      <desc>
        Condition here describes a measurable change in the state of a feature (as compared with some prior condition of the state). Please assess the amount of anthropogenic and natural impacts that the feature has suffered. Such impacts can be direct or indirect (caused by action but occur later in time or farther removed in space). They can be discrete or continuous, depending on whether the cause occurs only once, or recurs at intervals.
      </desc>
      <opts>
        <opt>
          N/A
        </opt>
        <opt>
          0 - No observation
        </opt>
        <opt>
          1 - pristine
          <desc>
            1 - pristine or only superficial damage, up to 10% of feature volume missing.
          </desc>
        </opt>
        <opt>
          2 - minor damage
          <desc>
            2- minor damage, 10-25% of feature volume missing.
          </desc>
        </opt>
        <opt>
          3 - damaged
          <desc>
            3 - considerable damage, up to 50% of feature volume missing.
          </desc>
        </opt>
        <opt>
          4 - seriously damaged
          <desc>
            4 - massive amount of damage, more than 50% of feature missing.
          </desc>
        </opt>
        <opt>
          5 - extinct or near extinct
          <desc>
            5 - nearly nothing remains of the feature.
          </desc>
        </opt>
      </opts>
    </Condition>
    <Principal_Source_of_Impact f="notnull">
      <desc>
        Please select the principal source of impact; identifying the cause of decline that has contributed most to either the amount of damage, its extent in 3D space or its duration. Please use the annotation to identify the causal agent of an impact. E.g. activities such as plowing, road construction, timber harvest can be potential impact agents, and can precipitate -cause other impacts, such as erosion through the removal of trees, or alteration by compaction of sediment, etc. The principal impacts are Anthropogenic (manmade), Animal activity, or Natural (erosion, compaction, ...etc), and Other. Please describe Other in an annotation.
      </desc>
      <opts>
        <opt>No observation</opt>
        <opt>Anthropogenic
          <opt>Agriculture</opt>
          <opt>Looting</opt>
          <opt>Excavation</opt>
          <opt>Road cut</opt>
          <opt>Construction</opt>
          <opt>Urban development</opt>
          <opt>Other</opt>
        </opt>
        <opt>Animal activity</opt>
        <opt>Natural
          <opt>Erosion</opt>
          <opt>Post-depositional</opt>
        </opt>
        <opt>Other (specify in Annotation)</opt>
      </opts>
    </Principal_Source_of_Impact>
    <Other_Sources_of_Impact/>
    <Archaeological_potential f="notnull">
      <desc>Archaeological potential is result of site formation and developmental history of a site both of which affect what is archaeologically knowable (Wildesen 1984, Schiffer 1976), a subjective judgment of the physical status of as feature in relation to the preservation of information on its use for future archaeological study.</desc>
      <opts>
        <opt>No observation
        </opt>
        <opt>1 - full
          <desc>
            1 - feature appears close to original condition and is likely to retain its full archaeological potential.
          </desc>
        </opt>
        <opt>2 - good
          <desc>
            2 - feature is slightly damaged and some archaeological potential is impaired, but lots remains.
          </desc>
        </opt>
        <opt>3 - impaired
          <desc>
            3 - archaeological potential of this feature is significantly compromised
          </desc>
        </opt>
        <opt>4 - minimal
          <desc>
            4 - archaeological potential of the feature is low or severly compromised
          </desc>
        </opt>
        <opt>5- none or nearly none
          <desc>
            5 - no or nearly no archaeological potential is left
          </desc>
        </opt>
        <opt>Other</opt>
      </opts>
    </Archaeological_potential>
    <Most_recent_damage_what f="notnull">
      Most recent damage (what)
      <desc>Select the most recent source of damage. Use annotation if damage type not listed.</desc>
      <opts>
        <opt>Not available</opt>
        <opt>Agriculture</opt>
        <opt>Looting</opt>
        <opt>Infrastructure</opt>
        <opt>Urban development</opt>
        <opt>Animal activity</opt>
        <opt>Topographic or post-depositional</opt>
        <opt>Other (specify in Annotation)</opt>
        <opt>Unknown</opt>
        <opt>None</opt>
      </opts>
    </Most_recent_damage_what>
    <Most_recent_damage_within f="notnull">
      Most recent damage (within)
      <opts>
        <opt>Last week</opt>
        <opt>Last month</opt>
        <opt>Last year</opt>
        <opt>Unknown</opt>
        <opt>Other</opt>
        <opt>None</opt>
      </opts>
    </Most_recent_damage_within>
    <RT_Description>
      <desc>Describe Robber's trenches - if present - in the following format separating trenches by semicolons and parameters by commas:[TrenchNumber,shape,dimensionx,dimensiony,depth,note;TrenchNumber,shape,radius,depth,note]. Example: [01,round,1.5m,0.5m,manually excavated hole;02,rectangle,0.5,2.5,0.3,neatly excavated shallow trench]</desc>
    </RT_Description>
    <Comments_and_Recommendations/>
    <CRM_Photos t="camera">
      <desc>Take a picture of each robber's trench with a scale.</desc>
    </CRM_Photos>
  </CRM>
</Feature>

<Shape>
  <Shape_Note>
    <Label f="id"/>
    <Note/>
  </Shape_Note>
</Shape>

<GPS_Location>
  <fmt>{{GPS_Location_Feature_ID}}-GPS-{{GPS_Location_ID}}</fmt>
  <GPS_Location_Information>
    <cols>
      <GPS_Location_Feature_ID f="readonly" i="Feature/General/Feature_ID"/>
      <GPS_Location_ID f="notnull autonum"/>
    </cols>
    <gps f="notnull"/>
  </GPS_Location_Information>
</GPS_Location>


<logic><![CDATA[
  /************************************ MAP *************************************/
  DATA_ENTRY_LAYER    = "Data Entry Layer";
  DATA_ENTRY_LAYER_ID = 0;
  void initMap() {
    String refMap = "Start/Map/Map";
    setMapZoom(refMap, 15.0f);
    // Shape
    isEntity = true;
    queryName = "Shape";
    querySQL = "SELECT uuid, aenttimestamp FROM latestNonDeletedArchEnt join aenttype using (aenttypeid) where aenttypename = 'Shape'";
    ps = createPointStyle(10, Color.YELLOW, 0.2f, 0.5f);
    ls = createLineStyle(10, Color.YELLOW, 0.05f, 0.3f, null);
    pos = createPolygonStyle(10, Color.parseColor("#440000FF"), createLineStyle(10, Color.parseColor("#AA000000"), 0.01f, 0.3f, null));
    ts = createTextStyle(10, Color.YELLOW, 30, Typeface.SANS_SERIF);
    showDatabaseLayer(refMap, "Shape Layer", isEntity, queryName, querySQL, ps, ls, pos, ts);
    // Data entry layer
    DATA_ENTRY_LAYER_ID = createCanvasLayer(refMap, DATA_ENTRY_LAYER);
    setSelectedLayer(refMap, DATA_ENTRY_LAYER);
  }
  void clearGeometry() {
    String  mapRef   = "Start/Map/Map";
    List    geometry = getGeometryList(mapRef, DATA_ENTRY_LAYER_ID);
    if (geometry == null)     return;
    if (geometry.size() == 0) return;
    for (geom : geometry) {
      print("Geometry cleared:" + geom.userData.geomId);
      clearGeometry(mapRef, geom.userData.geomId);
    }
  }
  boolean checkForGeometry() {
    String mapRef = "Start/Map/Map";
    List geometry = getGeometryList(mapRef, DATA_ENTRY_LAYER_ID);
    if (geometry == null || geometry.size() == 0) {
      String head = "Cannot Create Shape";
      String body = "At least one shape must be present on the data entry layer.";
      showWarning(head, body);
      return false;
    } else {
      return true;
    }
  }
  void centreMe() {
    String mapRef = "Start/Map/Map";
    if(!isExternalGPSOn() && !isInternalGPSOn()) {
      showToast("{GPS_Not_Initialised}");
    } else {
      centerOnCurrentPosition(mapRef);
    }
  }
  void refreshMap() {
    String mapRef = "Start/Map/Map";
    refreshMap(mapRef);
  }

  addOnEventCond("Start/Map/Create_Shape", "click", "checkForGeometry()");
  addOnEvent(
      "Start/Map/Create_Shape",
      "click",
      "setAutoSaveGeometry(getGeometryList(MAP_REF, DATA_ENTRY_LAYER_ID))",
      PRECEDENCE_MID+1);
  addOnEvent("Shape", "save", "clearGeometry()");

  void onSaveShape__() {
    String tabgroup = "shape";
    executeOnEvent(tabgroup, "create");
  }

  initMap();
  addOnEvent("Start/Map",           "show",  "refreshMap()");

  /****************************** DATE POPULATION *******************************/
  void setDayMonth() {
    ref     = "Feature/General/Date";

    fmt     = "dd MMM";
    date    = new Date();
    dateFmt = new java.text.SimpleDateFormat(fmt);
    dateStr = dateFmt.format(date);
    if(dateStr.endsWith(".")){
      dateStr = dateStr.substring(0, dateStr.length()-1);
    }
    setFieldValue(ref, dateStr);
  }

  addOnEvent("Feature", "create", "setDayMonth()");

  /********************************* TABLE VIEW *********************************/
  addOnEvent("Start/Table/Select_Date", "show", "populateDate()");
  addOnEvent("Start/Table", "show", "populateTable()");
  addOnEvent("Start/Table/Select_Date", "click", "populateTable()");

  void populateDate() {
    String refDate = "Start/Table/Select_Date";
    if(!isNull(getFieldValue(refDate)))
      setFieldValue("Start/Table/Select_Date", "");
    String refDate = "Start/Table/Select_Date";

    String q = "";
    q += "  SELECT distinct measure, measure";
    q += "  FROM latestNonDeletedAentValue join attributekey using (attributeid)";
    q += "  WHERE attributename = 'Date'";
    q += "  ORDER by measure;";


    FetchCallback popDate = new FetchCallback() {
      onFetch(result) {
        List l = new ArrayList();

        // Add all option to the list
        List all = new ArrayList();
        all.add("");
        all.add("None");
        all.add("");
        all.add("");

        // Add 'all' option to the List l
        l.add(all);
        // Add all existing Date record to List l
        l.addAll(result);
        // Populate dropdown list with List l

        populateDropDown(refDate, l);
      }
    };

    fetchAll(q, popDate);
    //setFieldValueFromLocalSettings("Start/Table/Select_Date");

  }

  loadEntityFromTable() {
    uuid = getTableValue();
    loadEntityFrom(uuid); // Auto-gen'd function
  }


   void populateTable() {
     String tabgroup = "Start";
     String refDate  = tabgroup + "/Table/Select_Date";
     String date = getFieldValue(refDate);
     String query = "";
     //setFieldValue(refDate,date);
     if(isNull(date)){
       //query = "SELECT * FROM perflog WHERE 1 = 0";
       query = "SELECT 1=0 FROM perflog;";
     }
     else{
     query += "select uuid, attributename, response ";
     query += "from ( ";
     query += "select uuid, attributename, group_concat(format(formatstring, vocabname, measure, freetext, certainty), appendcharacterstring) as response, substr(uuid,7,13) as uuidorder ";
     query += "  from (";
     query += "    select uuid, attributename, aenttypename, formatstring, vocabname, measure, freetext, certainty, appendcharacterstring, aentcountorder, vocabcountorder, attributeid ";
     query += "    from latestNonDeletedArchent ";
     query += "      JOIN aenttype using (aenttypeid) ";
     query += "      join idealaent using (aenttypeid) ";
     query += "      join attributekey using (attributeid) ";
     query += "      join latestNonDeletedAentValue using (uuid, attributeid) ";
     query += "      left outer join vocabulary using (attributeid, vocabid) ";
     query += "    order by uuid, aentcountorder, vocabcountorder ";
     query += "  ) ";
     query += "  where aenttypename='Feature' ";
     query += "  and attributename in ('Feature ID', 'Type', 'Date', 'Landuse around Feature', 'Landuse on top of Feature', 'Height Max', 'Diameter Max') ";
     query += "  and uuid in ( select uuid from latestNonDeletedAentValue where measure = {date}) ";
     query += "  group by uuid, attributeid ";
     query += "  having response is not null) ";
     query += "  order by uuidorder, uuid; ";
     query = dbReplaceFirst(query, "{date}", date);
    }
     tableRef       = "Start/Table/Table";
     headers        = new ArrayList();
     actionName     = "Load";
     actionIdx      = 0;
     actionCallback = "loadEntityFromTable()";
     headers.add("");
     headers.add("Feature ID");
     headers.add("Type");
     headers.add("Date");
     headers.add("Landuse around Feature");
     headers.add("Landuse on top of Feature");
     headers.add("Height Max");
     headers.add("Diameter Max");

     populateTablePivot(tableRef, query, headers, actionName, actionIdx, actionCallback);
   }

  /****************************** GIS POINT STYLES ******************************/
  //final String MAP_REF = "Start/Map/Map";
  /* Displays the geometry of each entity whose menu, by the name of `attribName`,
   * has `vocabName` saved in it. The geometry is displayed in whatever colour is
   * given by `geoColor`.
   *
   * The geometry is displayed in a layer called `layerName`. This is a
   * human-readable name that the user can use to toggle the visibility of the
   * geometry in the UI.
   */
  void showDatabaseLayerByVocabName(
      String attribName,
      String vocabName,
      int    geoColor, /* Example argument: Color.BLACK */
      String layerName
  ) {
    int transBlk = Color.parseColor("#AA000000");
    GeometryStyle sln_ = createLineStyle(10, transBlk, 0.01f, 0.3f, null);
    // Define arguments to `showDatabaseLayer`
    String q;
    q  = "SELECT uuid, aenttimestamp";
    q += "  FROM latestNonDeletedArchEnt";
    q += "  JOIN latestnondeletedaentvalue USING (uuid)";
    q += "  JOIN attributekey              USING (attributeid)";
    q += "  JOIN vocabulary                USING (vocabid)";
    q += " WHERE {vocabName}  IN ('', vocabname)";
    q += "   AND {attribName} IN ('', attributename)";
    q  = dbReplaceFirst(q, "{vocabName}",  vocabName);
    q  = dbReplaceFirst(q, "{attribName}", attribName);
    boolean isEntity = true;
    GeometryStyle spt = createPointStyle(10, geoColor, 0.2f, 0.5f);
    GeometryStyle sln = createLineStyle(10, geoColor, 0.05f, 0.3f, null);
    GeometryStyle spg = createPolygonStyle(10, geoColor, sln_);
    GeometryTextStyle stx = createTextStyle(
        10,
        Color.BLACK,
        40,
        Typeface.SANS_SERIF
    );
    showDatabaseLayer(
        MAP_REF,
        layerName,
        isEntity,
        layerName,
        q,
        spt,
        sln,
        spg,
        stx
    );
  }
  void showDatabaseLayerByVocabName(
      String vocabName,
      int    geoColor,
      String layerName
  ) {
    showDatabaseLayerByVocabName("", vocabName, geoColor, layerName);
  }
  void showDatabaseLayerByVocabName(String vocabName, int geoColor) {
    String layerName = guessArch16nValFromKey(vocabName);
    showDatabaseLayerByVocabName(vocabName, geoColor, layerName);
  }
  void initMap() {
    //showBaseMap(MAP_REF, "Base Map", "files/data/Map/Perachora.tif");
    /*
    showDatabaseLayerByVocabName("{1___pristine}",   Color.GREEN);
    showDatabaseLayerByVocabName("{2___minor_damage}", Color.BLUE);
    showDatabaseLayerByVocabName("{3___damaged}",  Color.YELLOW);
    showDatabaseLayerByVocabName("{4___seriously_damaged}", Color.parseColor("#FFA500"));//FFA500 is orange in hex
    showDatabaseLayerByVocabName("{5___extinct_or_near_extinct}", Color.RED);
    showDatabaseLayerByVocabName("{NA}",  Color.BLACK);
    */
    String refMap = "Start/Map/Map";
    isEntity = true;
    queryName = "Feature";
    querySQL = "SELECT uuid, aenttimestamp FROM latestNonDeletedArchEnt join aenttype using (aenttypeid) where aenttypename = 'Feature'";
    ps = createPointStyle(10, Color.BLUE, 0.2f, 0.5f);
    ls = createLineStyle(10, Color.BLUE, 0.05f, 0.3f, null);
    pos = createPolygonStyle(10, Color.parseColor("#440000FF"), createLineStyle(10, Color.parseColor("#AA000000"), 0.01f, 0.3f, null));
    ts = createTextStyle(10, Color.BLUE, 30, Typeface.SANS_SERIF);
    showDatabaseLayer(refMap, "Feature Layer", isEntity, queryName, querySQL, ps, ls, pos, ts);
    setMapZoom(MAP_REF, 13.0f);
  }
  initMap();

  /********************************* CUSTOM SEARCH ******************************/
  addOnEvent("Start/Search", "show", "populateSelectAuthor()");
  addOnEvent("Start/Search/Select_Author", "click", "search()");
  void populateSelectAuthor(){
  String refSearchUsers = "Start/Search/Select_Author";
  String getNonDeletedUsersQuery = "SELECT userid, fname || ' ' || lname "+
                                   "  FROM user "+
                                   " WHERE userdeleted is null "+
                                   " UNION " +
                                   "SELECT -1, '{All}'";

  fetchAll(getNonDeletedUsersQuery, new FetchCallback() {
    onFetch(result) {
      populateDropDown(refSearchUsers, result, false);
      search();
    }
  });
  }

  // Overrides auto-generated definition
  void search(){
  String refEntityList    = "Start/Search/Entity_List";
  String refSearchTerm    = "Start/Search/Search_Term";
  String refEntityTypes   = "Start/Search/Entity_Types";
  String refSelectAuthor  = "Start/Search/Select_Author";
  String type = getFieldValue(refEntityTypes);
  String term = getFieldValue(refSearchTerm);

  String user = getFieldValue(refSelectAuthor);
  String searchQuery = "SELECT uuid, response "+
                       "  FROM latestNonDeletedArchEntFormattedIdentifiers  "+
                       " WHERE uuid in (SELECT uuid "+
                       "                  FROM latestNonDeletedArchEntIdentifiers "+
                       "                 WHERE measure LIKE {term}||'%'  "+
                       "                   AND ( aenttypename = {type} OR '' = {type} ) "+
                       " AND ( userid = {user} OR -1 = {user}) " +
                       "                )  "+
                       " ORDER BY substr(uuid, 7, 13) DESC "+
                       " LIMIT ? "+
                       "OFFSET ? ";
  searchQuery = dbReplaceFirst(searchQuery, "{term}", term);
  searchQuery = dbReplaceFirst(searchQuery, "{type}", type);
  searchQuery = dbReplaceFirst(searchQuery, "{type}", type);
  searchQuery = replaceFirst(searchQuery, "{user}", user);
  searchQuery = replaceFirst(searchQuery, "{user}", user);
  populateCursorList(refEntityList, searchQuery, 25);
  refreshTabgroupCSS("Start");

  Log.d("Module", "Search query: " + searchQuery);
  }

  /*************************** Retain field Source value **********************/
  insertIntoLocalSettingsOnChange("Feature/General/Source");
  addOnEvent("Feature", "create", "setFieldValueFromLocalSettings(\"Feature/General/Source\")");

  /********************** Custom Location for Valdiate button *****************/
  // Add validation button as the first item in Feature/General tab
  addOnEvent("Feature/General/Validate", "click", "validateFeature()");

  addOnEvent("Feature", "copy", "setDayMonth()");

  /**************************    No null user login   ***************************/
  // Check if userId is null, if so then prompt warning message, else allow login
  boolean validateUserLogin () {
    boolean isValid = !isNull(userId);
    if (!isValid)
      showWarning("No user selected", "To log in, please select a user.");
    return isValid;
  }
  addOnEventCond("User/User/Log_in", "click", "validateUserLogin()");

//Set sync to be disabled by default
setFileSyncEnabled(false);
setSyncEnabled (false);
/********************************** Vector Layer ****************************/
  //Helper function to showSpatialLayer
  void showSpatialLayerHelper(String dbLocation, String mapRef,String table, String idCol, String labCol, String name, int c){
    ps = createPointStyle(10, c, 0.2f, 0.5f);
    ls = createLineStyle(10, c, 0.05f, 0.3f, null);
    pos = createPolygonStyle(10, Color.parseColor("#440000FF"), createLineStyle(10, Color.parseColor("#AA000000"), 0.01f, 0.3f, null));
    ts = createTextStyle(10, c, 40, Typeface.SANS_SERIF);
    showSpatialLayer(mapRef, name, dbLocation, table, idCol, labCol, ps, ls, pos, ts);
  }

  //Preload all Spatial Layer
  void loadSpatialLayers(){
    String vectorDBLoc = "files/data/Map/spatialite.Vectors4FAIMS.32635.db";
    String mapRef = "Start/Map/Map";
    showSpatialLayerHelper(vectorDBLoc, mapRef, "YamLegGC","PK_UID", "ObjectID", "GC", Color.GREEN);
    showSpatialLayerHelper(vectorDBLoc, mapRef, "yamlegneedgc","PK_UID", "TopoID", "Need GC",Color.RED );
    showSpatialLayerHelper(vectorDBLoc, mapRef, "roads","PK_UID", "ObjectID", "Roads", Color.BLACK);//Black
    showSpatialLayerHelper(vectorDBLoc, mapRef, "towns","PK_UID", "name_en", "Towns", Color.GRAY); //Grey
    showSpatialLayerHelper(vectorDBLoc, mapRef, "yambolregion","PK_UID", "name_en", "Yambol Region", Color.MAGENTA);
  }

  addOnEvent("module", "load", "loadSpatialLayers()");




]]></logic>

</module>
